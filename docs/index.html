<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wilder.io</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

  <style>
    body, html {
      height: 100%;
      margin: 0;
      padding: 0;
      width: 100vw;
      min-height: 100vh;
      box-sizing: border-box;
      font-family: 'VT323', monospace;
    }
    #homePage.menu {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1;
      text-align: center;
      min-width: 300px;
      background: rgba(0,0,0,0.15);
      border-radius: 16px;
      padding: 32px 24px 24px 24px;
      box-shadow: 0 4px 32px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #homePage.menu input, 
    #homePage.menu select {
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      border: none;
      border-radius: 8px;
      padding: 12px;
      font-size: 1.1em;
      margin-bottom: 12px;
    }
    #homePage.menu h2 {
      font-family: cursive;
      font-weight: bold;
      font-size: 64px;
      margin-bottom: 32px;
      width: 100%;
      color: #e0e0e0; /* lighter color for contrast */
      text-shadow: 1px 1px 4px rgba(0,0,0,0.7);
    }
    #homePage.menu button {
      font-family: 'VT323', monospace;
      font-weight: bold;
      display: block;
      margin: 12px auto;
      font-size: 1.2em;
      padding: 10px 32px;
      border-radius: 8px;
      border: none;
      background: #6bbf4e;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: background 0.2s;
      width: 100%;
      max-width: 400px;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.7);
    }
    #homePage.menu button:hover {
      background: #4e8f36;
    }
    /* Soul Reset Button: visually matches homePage.menu button, but fixed at bottom right */
    .home-reset-btn {
      font-family: 'VT323', monospace;
      font-weight: bold;
      display: block;
      font-size: 1.2em;
      padding: 10px 32px;
      border-radius: 8px;
      border: none;
      background: #ff3a3a;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: background 0.2s;
      font-weight: bold;
      margin: 0;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.7);
    }
    .home-reset-btn:hover {
      background: #c62828;
      transform: scale(1.05);
    }
  </style>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <!-- Google AdSense script -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9737086182343099"
     crossorigin="anonymous"></script>
</head>
<body>

  <!-- Idle Animated Background Canvas for Main Page -->
  <canvas id="menuBgCanvas" style="position:fixed; top:0; left:0; width:100vw; height:100vh; z-index:0;"></canvas>

  <!-- Soul Currency Display (top left, homepage only) -->
  <div id="soulDisplayHome" style="position:fixed; top:16px; left:16px; z-index:2001; font-family: 'VT323', monospace; font-size:24px; color:#00ff33; background:rgba(0,0,0,0.5); padding:8px 18px; border-radius:12px; display:none; pointer-events:none;">
    <span id="soulAmountHome">Soul: 0</span><br>
    <span id="difficultyProgressionHome" style="color:#ffffff; font-family: 'VT323', monospace; font-size:24px; display:block; margin-top:2px;">Highest Difficulty: 0</span>
  </div>
  <style>
    #koFiButton:hover {
      background: #1f7bbf;
      transform: scale(1.05);
      transition: all 0.2s ease;
    }
  </style>
  <button id="koFiButton" onclick="window.open('https://ko-fi.com/bobbrine', '_blank')"
          style="font-family: 'VT323', monospace; font-weight: bold; text-shadow: 1px 1px 4px rgba(0,0,0,0.7); position:fixed; left:24px; bottom:24px; z-index:2002; background:#29abe0; color:white; font-size:1.2em; padding:10px 32px; border:none; border-radius:8px; cursor:pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
    â˜• Support on Ko-fi
  </button>
  <!-- Home Page -->
  <div id="homePage" class="menu">
    <h2>Wilder.io</h2>
    
    <!-- Content Wrapper for Consistent Width -->
    <div style="display: flex; flex-direction: column; width: 100%; max-width: 400px; margin: 0 auto;">
      <!-- Player Name Input with improved layout -->
      <div style="display: flex; margin-bottom: 12px;">
        <input id="playerNameInputHome" type="text" placeholder="Enter your name" 
              style="font-family: 'VT323', monospace; font-weight: bold;" />
        <button onclick="playNow()" 
                style="margin-left: 8px; margin-top: 0px; padding: 14px 48px; width: 160px; border-radius: 8px; border: none; 
                      background: #6bbf4e; color: white; cursor: pointer; font-size: 1.1em;">
          Play
        </button>
      </div>
      
      <!-- Server Selection -->
      <select id="serverSelect" style="font-family: 'VT323', monospace; font-weight: bold; width: 100%; padding: 12px; border-radius: 8px; border: none; font-size: 1.1em; height: 46px; margin-bottom: 12px;">
        <option value="https://survival-io-md0m.onrender.com">Main Server (Render)</option>
        <option value="https://70fbf268-5e7f-48d3-bb25-2ba3aaae13e5-00-kgtz2yaascf1.picard.replit.dev/">Replit Server</option>
      </select>
    
      <button onclick="showHowToModal()">How to Play</button>
      <button onclick="showPrivacyModal()">Privacy Policy</button>
    </div>
  </div>

  <!-- Soul Reset Button (bottom right, overlays canvas, only on home page) -->
  <button id="resetSoulBtn" style="position:fixed; right:24px; bottom:24px; z-index:2002; display:none; width:260px; max-width:80vw;" class="home-reset-btn">Reset</button>


  <!-- How to Play Modal -->
  <div id="howToModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:1000; align-items:center; justify-content:center;">
    <div style="background:#fff; border-radius:12px; max-width:500px; margin:40px auto; padding:32px; box-shadow:0 4px 32px #0004; position:relative;">
      <h2>How to Play</h2>
      <ul>
        <li>Use your mouse and keyboard to move, gather, and fight.</li>
        <li>Collect resources like wood, stone, and food.</li>
        <li>Craft tools and weapons to improve your chances.</li>
        <li>Watch your health and hunger bars!</li>
        <li>Compete with other players for survival and XP.</li>
      </ul>
      </ul>
      <p style="font-style: italic; color: #000000;">
        ðŸ’¡ Tip: Play at <strong>67% zoom</strong> on your desktop browser for better resolution.
      </p>
      <button onclick="closeHowToModal()" style="margin-top:16px;">Close</button>
    </div>
  </div>

  <!-- Privacy Policy Modal -->
  <div id="privacyModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); z-index:1000; align-items:center; justify-content:center;">
    <div style="background:#fff; border-radius:12px; max-width:500px; margin:40px auto; padding:32px; box-shadow:0 4px 32px #0004; position:relative;">
      <h2>Privacy Policy</h2>
      <p>This game does not collect personal information except as required for gameplay and analytics. Third-party services (such as Google AdSense) may use cookies to serve ads based on your prior visits to this or other websites. You can opt out of personalized advertising by visiting <a href='https://www.google.com/settings/ads' target='_blank'>Google Ads Settings</a>.</p>
      <p>For questions, contact: <a href="mailto:bobgamingprolol@gmail.com">bobgamingprolol@gmail.com</a></p>
      <button onclick="closePrivacyModal()" style="margin-top:16px;">Close</button>
    </div>
  </div>


  <!-- Server Join Page -->
  <div id="serverJoin" class="menu" style="display: none;">
    <h2>Join Main Server</h2>
    <p id="serverStatus">Connecting to main server...</p>
    <button onclick="backToHome()">Back</button>
  </div>




  

  <!-- Death Screen -->
  <div id="deathScreen" class="menu" style="display: none;">
    <h2>You Died!</h2>
    <button onclick="backToMain()">Back to Main</button>
  </div>

  <!-- Settings Overlay (visual only) -->
  <div id="settingsOverlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.25); pointer-events:none; z-index:900;"></div>

  <!-- Settings Panel -->
  <div id="settingsPanel" class="menu" style="display:none; z-index:1100; min-width: 360px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
      <h3 style="margin:0;">Settings</h3>
      <button id="settingsCloseBtn" title="Close" style="padding:6px 10px; font-size:14px;">âœ•</button>
    </div>
    <div style="display:flex; flex-direction:column; gap:10px;">
      <button id="settingsRespawnBtn">Respawn Player</button>
      <button id="settingsPerformanceBtn">Performance: Toggle</button>
      <button id="settingsDebugBtn">Debug: Toggle</button>
      <button id="settingsControlsModeBtn">Controls: PC</button>
      <!-- Add sound controls here -->
      <button id="settingsSoundBtn">Sound: On</button>
      <div id="settingsVolumeRow" style="display:flex; gap:8px; align-items:center;">
        <label for="settingsVolumeSlider" style="flex:0 0 130px; text-align:left;">Volume</label>
        <input id="settingsVolumeSlider" type="range" min="0" max="100" step="5" value="100" style="flex:1;" />
        <span id="settingsVolumeValue" style="min-width:46px; text-align:right;">100%</span>
      </div>
      <div id="settingsJoystickRow" style="display:none; gap:8px; align-items:center;">
        <label for="settingsJoystickScale" style="flex:0 0 130px; text-align:left;">Joystick Size</label>
        <input id="settingsJoystickScale" type="range" min="0.6" max="1.6" step="0.05" value="1.0" style="flex:1;" />
        <span id="settingsJoystickScaleVal" style="min-width:46px; text-align:right;">1.0Ã—</span>
      </div>
      <button id="settingsGoMainBtn">Go Main</button>
    </div>
  </div>

  <!-- Gear Icon (under scoreboard) -->
  <div id="settingsGear" title="Settings" style="display:none; position:fixed; right:10px; top:190px; width:36px; height:36px; border-radius:8px; background:rgba(0,0,0,0.6); color:#fff; font-size:22px; line-height:36px; text-align:center; cursor:pointer; z-index:1050; user-select:none;">âš™</div>

  <!-- Drop Amount Prompt -->
  <div id="dropAmountPrompt" class="menu" style="display: none;">
    <h2>Drop Item</h2>
    <input id="dropAmountInput" type="number" min="1" placeholder="Amount to drop" />
    <button onclick="submitDropAmount()">Drop</button>
    <button onclick="dropAll()">Drop All</button>
  </div>

  <!-- Game Canvas -->
  <canvas id="gameCanvas"></canvas>

  <!-- Privacy Policy Section removed: now only accessible via modal -->

  <script>
    // Add event listener for Reset Soul button
    document.addEventListener('DOMContentLoaded', function() {
      var resetBtn = document.getElementById('resetSoulBtn');
      if (resetBtn) {
        resetBtn.addEventListener('click', function() {
          // Reset soul currency
          if (window.soulCurrency && typeof window.soulCurrency.set === 'function') {
            window.soulCurrency.set(0);
          } else {
            localStorage.setItem('soulCurrency', '0');
          }
          // Reset highest difficulty
          window.difficultyProgression = 0;
          localStorage.setItem('difficulty.progression', '0');
          // Dispatch events to update UI
          window.dispatchEvent(new CustomEvent('soulChanged'));
          window.dispatchEvent(new CustomEvent('difficultyProgressionChanged'));
          // Optionally, show a message
          if (typeof window.showMessage === 'function') {
            window.showMessage('Progress reset!', 2);
          } else {
            alert('Progress reset!');
          }
        });
      }
    });
    const version = "1.1.3";
    const scripts = [
      "js/soul.js",
      "js/menuBackground.js",
      "js/resourceTypes.js",
      "js/mobs.js",
      "js/player.js",
      "js/tool.js",
      "js/crafting&tool.js",
      "js/hotbar.js",
      "js/inventory.js",
      "js/sound.js",
      "js/ui.js",
      "js/network.js",
      "js/settingsPanel.js",
      "js/canvas.js",
      "js/camera.js",
      "js/mobileControls.js",
      "js/input.js",
      "js/main.js"
    ];

    scripts.forEach(src => {
      const script = document.createElement("script");
      script.src = `${src}?v=${version}`;
      document.head.appendChild(script);
    });
  </script>
  <script>
    // Add event listener to play select sound on all button clicks
    document.addEventListener('DOMContentLoaded', function() {
      // Function to play select sound
      function playButtonSound() {
        if (typeof playSelect === 'function') {
          playSelect();
        }
      }
      
      // Add event listeners to all existing buttons
      document.querySelectorAll('button').forEach(button => {
        button.addEventListener('click', playButtonSound);
      });
      
      // Use MutationObserver to handle dynamically created buttons
      const observer = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
          mutation.addedNodes.forEach(node => {
            if (node.nodeType === 1) { // Element node
              if (node.tagName === 'BUTTON') {
                node.addEventListener('click', playButtonSound);
              }
              // Check for buttons inside added nodes
              node.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', playButtonSound);
              });
            }
          });
        });
      });
      
      // Start observing the document for changes
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    });
  </script>
  <script>
    // Show siteContent only on home page
    function showSiteContent(show) {
      // No longer show siteContent or privacy by default
    }
    // Modal logic
    function showHowToModal() {
      document.getElementById('howToModal').style.display = 'flex';
    }
    function closeHowToModal() {
      document.getElementById('howToModal').style.display = 'none';
    }
    function showPrivacyModal() {
      document.getElementById('privacyModal').style.display = 'flex';
    }
    function closePrivacyModal() {
      document.getElementById('privacyModal').style.display = 'none';
    }

    const origPlayNow = window.playNow;
    window.playNow = function() {
      showSiteContent(false);
      try {
        const mode = (window.controlsSettings && window.controlsSettings.getMode && window.controlsSettings.getMode()) || (localStorage.getItem('controls.mode') || 'pc');
        window.mobileControls && window.mobileControls.setVisible(mode === 'mobile');
        // Enable game canvas interactions during gameplay
        var gc = document.getElementById('gameCanvas'); 
        if (gc) gc.style.pointerEvents = 'auto';
      } catch (_) {}
      if (origPlayNow) origPlayNow();
    };

    // Patch backToHome to always show siteContent
    const origBackToHome = window.backToHome;
    window.backToHome = function() {
      showSiteContent(true);
      try { window.mobileControls && window.mobileControls.setVisible(false); } catch (_) {}
      // Disable game canvas interactions while in menus so it doesn't block taps
      try { var gc = document.getElementById('gameCanvas'); if (gc) gc.style.pointerEvents = 'none'; } catch(_) {}
      if (origBackToHome) origBackToHome();
    };
    // On page load, show siteContent
    showSiteContent(true);
    // Ensure canvas is not blocking clicks on home page initially
    try { var gc = document.getElementById('gameCanvas'); if (gc) gc.style.pointerEvents = 'none'; } catch(_) {}

    // Also enable canvas when name is submitted (some flows go via nameEntry)
    const origSubmitName = window.submitName;
    window.submitName = function(){
      try { var gc = document.getElementById('gameCanvas'); if (gc) gc.style.pointerEvents = 'auto'; } catch(_) {}
      if (origSubmitName) return origSubmitName();
    };
    // SOUL: Show/hide and update soul display on homepage
    function updateSoulDisplayHome() {
      const el = document.getElementById('soulDisplayHome');
      const soulSpan = document.getElementById('soulAmountHome');
      const diffSpan = document.getElementById('difficultyProgressionHome');
      const resetBtn = document.getElementById('resetSoulBtn');
      const koFiBtn = document.getElementById('koFiButton');
      const homeVisible = document.getElementById('homePage').style.display !== 'none';
      if (el) {
        el.style.display = homeVisible ? 'block' : 'none';
        if (window.soulCurrency && soulSpan) {
          soulSpan.textContent = 'Soul: ' + window.soulCurrency.get();
        }
        if (diffSpan) {
          let prog = 0;
          if (typeof window.difficultyProgression !== 'undefined') prog = window.difficultyProgression;
          else prog = Number(localStorage.getItem('difficulty.progression') || '0');
          diffSpan.textContent = 'Highest Difficulty: ' + prog;
        }
      }
      if (resetBtn) {
        resetBtn.style.display = homeVisible ? 'block' : 'none';
      }
      if (koFiBtn) koFiBtn.style.display = homeVisible ? 'block' : 'none';
    }
    window.addEventListener('DOMContentLoaded', updateSoulDisplayHome);
    window.addEventListener('soulChanged', updateSoulDisplayHome);
   window.addEventListener('difficultyProgressionChanged', updateSoulDisplayHome);
    setInterval(updateSoulDisplayHome, 500);
    // Also update on navigation
    [window.backToHome, window.playNow].forEach(fn => { // Changed to playNow
      if (typeof fn === 'function') {
        const orig = fn;
        fn = function() { orig.apply(this, arguments); updateSoulDisplayHome(); };
      }
    });
  </script>
</body>
</html>